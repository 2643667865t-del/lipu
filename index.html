<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡Œæ™®ä¸“å± Â· åŠ æ‹¿å¤§é¢„æµ‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #007AFF;
            --secondary: #5856D6;
            --accent: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            --success: #30D158;
            --text: #1C1C1E;
            --text-light: #8E8E93;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-bg-strong: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.8);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            --shadow-elevated: 0 12px 40px rgba(0, 0, 0, 0.12);
            --border-radius: 20px;
            --border-radius-sm: 16px;
            --transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --dynamic-island-height: 38px;
            --safe-area-top: env(safe-area-inset-top);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Icons", "Helvetica Neue", Helvetica, Arial, sans-serif;
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            padding-top: calc(var(--safe-area-top) + var(--dynamic-island-height) + 16px);
            padding-bottom: calc(var(--safe-area-bottom) + 16px);
            min-height: 100vh;
            background: linear-gradient(135deg, #F2F2F7 0%, #E5E5EA 50%, #F2F2F7 100%);
            background-attachment: fixed;
            overflow-x: hidden;
        }

        .container {
            max-width: 540px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 24px;
            margin-bottom: 24px;
            transition: var(--transition);
            overflow: hidden;
            position: relative;
            border: 1px solid var(--glass-border);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 28px;
            font-size: 17px;
            font-weight: 600;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 122, 255, 0.15);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #0056CC;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.25);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .result-container {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.7);
            border-radius: var(--border-radius-sm);
            padding: 24px;
            margin-top: 20px;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 14px;
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .kill-item {
            background: rgba(255, 59, 48, 0.08);
            border: 1px solid rgba(255, 59, 48, 0.2);
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            font-weight: 600;
            text-align: center;
        }

        .prediction-combo {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.08), rgba(88, 86, 214, 0.08));
            padding: 20px;
            border-radius: 14px;
            margin-bottom: 16px;
            border: 1px solid rgba(0, 122, 255, 0.15);
        }

        .lottery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .lottery-item {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 14px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: var(--transition);
        }

        .loading {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* iOS 26 åŠ¨æ€å²›æ ·å¼ */
        .dynamic-island {
            position: fixed;
            top: calc(var(--safe-area-top) + 8px);
            left: 50%;
            transform: translateX(-50%);
            width: 130px;
            height: var(--dynamic-island-height);
            background: rgba(0, 0, 0, 0.8);
            border-radius: 40px;
            z-index: 1000;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 15px;
            font-weight: 600;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }

        /* æ ‡é¢˜æ æ ·å¼ */
        header.card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.6));
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        h1, h2 {
            background: linear-gradient(135deg, #1C1C1E, #3A3A3C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .text-primary {
            color: var(--primary) !important;
        }

        .text-danger {
            color: var(--danger) !important;
        }

        .text-secondary {
            color: var(--secondary) !important;
        }

        .text-success {
            color: var(--success) !important;
        }

        .algorithm-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 4px;
        }

        .algorithm-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .algorithm-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.2);
        }

        .algorithm-description {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            font-size: 14px;
            line-height: 1.5;
        }

        /* ç§»é™¤ç”¨æˆ·ç›¸å…³æ ·å¼ï¼Œä¿ç•™åŠŸèƒ½æ ·å¼ */
        .user-info, .auth-form, .admin-panel, .auth-tabs {
            display: none !important;
        }
    </style><script>
/*!
 * é‡Œæ™®ä¸“å±é¢„æµ‹ç³»ç»Ÿ - æºç ä¿æŠ¤
 * ä½œè€…: lipu3888888
 * ç‰ˆæœ¬: 1.0
 */

// ç«‹å³æ‰§è¡Œå‡½æ•°ä¿æŠ¤
(function() {
    'use strict';
    
    // === åŸºç¡€ä¿æŠ¤ ===
    
    // 1. é˜²æ­¢å³é”®èœå•
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        showWarning('å·²ç¦æ­¢æ­¤è¡Œä¸º');
        return false;
    });
    
    // 2. é˜²æ­¢é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', function(e) {
        const blockedKeys = [
            'F12', 
            'F11',
            'PrintScreen'
        ];
        
        const blockedCombinations = [
            e.ctrlKey && e.shiftKey && e.key === 'I',      // Ctrl+Shift+I
            e.ctrlKey && e.shiftKey && e.key === 'J',      // Ctrl+Shift+J  
            e.ctrlKey && e.shiftKey && e.key === 'C',      // Ctrl+Shift+C
            e.ctrlKey && e.key === 'U',                    // Ctrl+U
            e.ctrlKey && e.key === 'S',                    // Ctrl+S
            e.altKey && e.key === 'F4'                     // Alt+F4
        ];
        
        if (blockedKeys.includes(e.key) || blockedCombinations.some(combo => combo)) {
            e.preventDefault();
            showWarning('æ“ä½ å¦ˆé€¼å·ä½ å¦ˆæºç å‘¢ ä¸ä¼šä»–å¦ˆè‡ªå·±å†™å—');
            return false;
        }
    });
    
    // 3. é˜²æ­¢å¼€å‘è€…å·¥å…·
    function detectDevTools() {
        const threshold = 200;
        
        // æ£€æµ‹çª—å£å¤§å°å·®å¼‚
        const widthDiff = window.outerWidth - window.innerWidth;
        const heightDiff = window.outerHeight - window.innerHeight;
        
        // æ£€æµ‹æ§åˆ¶å°æ‰“å¼€
        const consoleOpen = widthDiff > threshold || heightDiff > threshold;
        
        // æ£€æµ‹è°ƒè¯•æ¨¡å¼
        const start = Date.now();
        debugger;
        const debuggerTime = Date.now() - start;
        const debuggerDetected = debuggerTime > 100;
        
        if (consoleOpen || debuggerDetected) {
            takeProtectiveAction();
            return true;
        }
        
        return false;
    }
    
    // 4. ä¿æŠ¤åŠ¨ä½œ
    function takeProtectiveAction() {
        // æ¸…ç©ºé¡µé¢å†…å®¹
        document.body.innerHTML = '';
        
        // åˆ›å»ºè­¦å‘Šé¡µé¢
        const warningHTML = `
            <div style="
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(45deg, #ff0000, #8b0000);
                color: white;
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
                font-family: Arial, sans-serif;
                z-index: 99999;
                text-align: center;
            ">
                <div style="background: rgba(0,0,0,0.8); padding: 40px; border-radius: 20px; border: 3px solid white;">
                    <h1 style="font-size: 2.5em; margin-bottom: 20px; color: #ff6b6b;">ğŸš« å®‰å…¨è­¦å‘Š</h1>
                    <p style="font-size: 1.2em; margin-bottom: 10px;">æ£€æµ‹åˆ°éæ³•è®¿é—®è¡Œä¸º</p>
                    <p style="font-size: 1em; margin-bottom: 20px; opacity: 0.8;">å¼€å‘è€…å·¥å…·å·²è¢«ç¦ç”¨</p>
                    <div style="font-size: 0.9em; opacity: 0.6;">
                        <p>è¯·å…³é—­å¼€å‘è€…å·¥å…·ååˆ·æ–°é¡µé¢</p>
                        <p>é‡Œæ™®ä¸“å±é¢„æµ‹ç³»ç»Ÿ - ç‰ˆæƒæ‰€æœ‰</p>
                    </div>
                </div>
            </div>
        `;
        
        document.body.innerHTML = warningHTML;
        
        // é˜»æ­¢ä»»ä½•åç»­æ“ä½œ
        document.addEventListener('keydown', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        });
        
        document.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        });
        
        // æ— é™å¾ªç¯é˜»æ­¢
        setInterval(function() {
            window.location.href = 'about:blank';
        }, 100);
        
        throw new Error('Security Violation Detected');
    }
    
    // 5. æ˜¾ç¤ºè­¦å‘Š
    function showWarning(message) {
        // åˆ›å»ºä¸´æ—¶è­¦å‘Š
        const warning = document.createElement('div');
        warning.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff4757;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 10000;
            font-family: Arial, sans-serif;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        warning.textContent = message;
        document.body.appendChild(warning);
        
        setTimeout(() => {
            if (document.body.contains(warning)) {
                document.body.removeChild(warning);
            }
        }, 2000);
    }
    
    // === é«˜çº§ä¿æŠ¤ ===
    
    // 6. ä»£ç æ··æ·†ä¿æŠ¤
    function obfuscateCode() {
        // ç¦ç”¨æ§åˆ¶å°æ–¹æ³•
        if (window.console) {
            const consoleMethods = ['log', 'warn', 'error', 'info', 'debug', 'table', 'group', 'groupEnd'];
            consoleMethods.forEach(method => {
                console[method] = function() {};
            });
        }
        
        // é‡å†™é‡è¦å‡½æ•°
        const originalSetTimeout = window.setTimeout;
        window.setTimeout = function(fn, delay) {
            if (typeof fn === 'string' && fn.includes('debugger')) {
                return;
            }
            return originalSetTimeout(fn, delay);
        };
    }
    
    // 7. é˜²æ­¢iframeåµŒå…¥
    if (window.top !== window.self) {
        window.top.location.href = window.self.location.href;
    }
    
    // 8. é˜²æ­¢æºç ä¿å­˜
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 's') {
            e.preventDefault();
            showWarning('é¡µé¢ä¿å­˜å·²è¢«ç¦ç”¨');
            return false;
        }
    });
    
    // === å¯åŠ¨ä¿æŠ¤ ===
    
    // ç«‹å³æ‰§è¡Œæ£€æµ‹
    detectDevTools();
    
    // å®šæ—¶æ£€æµ‹ï¼ˆæ¯500msï¼‰
    setInterval(detectDevTools, 500);
    
    // åº”ç”¨ä»£ç æ··æ·†
    obfuscateCode();
    
    // é¡µé¢å¯è§æ€§å˜åŒ–æ£€æµ‹
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            // é¡µé¢è¢«åˆ‡æ¢ï¼ŒåŠ å¼ºä¿æŠ¤
            obfuscateCode();
        }
    });
    
    // é˜²æ­¢å¸è½½æ—¶æš´éœ²ä¿¡æ¯
    window.addEventListener('beforeunload', function(e) {
        // æ¸…ç†æ•æ„Ÿæ•°æ®
        localStorage.removeItem('accuracyStats');
        sessionStorage.clear();
    });
    
})();

// é˜²æ­¢ä»£ç æ ¼å¼åŒ–
// prettier-ignore
!function(){var t=function(){};t.prototype.encrypt=function(t){return btoa(t)},t.prototype.decrypt=function(t){return atob(t)},window.CodeProtector=new t}();

/* é‡Œæ™®ä¸“å±é¢„æµ‹ç³»ç»Ÿ - å®‰å…¨ä¿æŠ¤å·²å¯ç”¨ */
console.log('%cğŸš« ç¦æ­¢è®¿é—®', 'color: red; font-size: 50px; font-weight: bold;');
console.log('%cæ­¤æµè§ˆå™¨æ§åˆ¶å°ä»…ä¾›å¼€å‘ä½¿ç”¨\nä»»ä½•å°è¯•è®¿é—®ç³»ç»Ÿæºç çš„è¡Œä¸ºéƒ½å°†è¢«è®°å½•', 'color: yellow; font-size: 16px;');
</script>

<style>
/* é˜²æ­¢ç”¨æˆ·é€‰æ‹©æ–‡æœ¬ */
* {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* é˜²æ­¢å›¾ç‰‡æ‹–æ‹½ */
img {
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
}

/* éšè—æºç æ ‡ç­¾ */
script, style, link[rel="stylesheet"] {
    display: none !important;
}

/* é˜²æ­¢æŸ¥çœ‹å…ƒç´  */
body::before {
    content: "é‡Œæ™®ä¸“å±é¢„æµ‹ç³»ç»Ÿ - æºç å—ä¿æŠ¤";
    display: none;
}
</style>
</head>
<body>
    <div class="dynamic-island">
        <i class="fas fa-chart-line"></i>
        <span>é¢„æµ‹ç³»ç»Ÿ</span>
    </div>

    <div class="container">
        <div id="mainApp">
            <header class="card text-center">
                <div class="text-5xl mb-4 text-primary"><i class="fas fa-chart-line"></i></div>
                <h1 class="text-2xl md:text-3xl font-bold mb-2">é‡Œæ™®ä¸“å± å½¢æ€æ•°æ®åˆ†æç®—æ³•é¢„æµ‹ç³»ç»Ÿ</h1>
                <p class="text-sm text-text-light">ç†æ€§æŠ•æ³¨ Â· ä½œè€…@lipu3888888</p>
            </header>

            <section class="card">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-calculator text-primary"></i>
                    <span>ç®—æ³•é¢„æµ‹</span>
                </h2>
                
                <div class="algorithm-tabs">
                    <div class="algorithm-tab active" data-algorithm="3y">å½¢æ€æ•°æ®ç®—æ³•</div>
                    <div class="algorithm-tab" data-algorithm="canada28">åŠ æ‹¿å¤§28ç®—æ³•</div>
                </div>
                
                <div class="algorithm-description" id="algorithm-description">
                    <strong>å½¢æ€æ•°æ®åˆ†æç®—æ³•</strong>ï¼šåŸºäºä¸‰æœŸå†å²æ•°æ®ï¼Œé€šè¿‡å½¢æ€å±æ€§å’Œæ•°æ®åˆ†æã€å¤§å°å•åŒç±»å‹è¿›è¡Œé¢„æµ‹ï¼Œç»“åˆæ€å·è§„åˆ™æé«˜å‡†ç¡®æ€§ã€‚
                </div>
                
                <button id="predict-btn" class="btn btn-primary w-full">
                    <i class="fas fa-bolt"></i> å¼€å§‹é¢„æµ‹
                </button>

                <div class="result-container">
                    <div id="result-content" class="space-y-4">
                        <div class="text-center py-6 text-text-light">
                            ç‚¹å‡»"å¼€å§‹é¢„æµ‹"æŒ‰é’®è¿›è¡Œè®¡ç®—
                        </div>
                    </div>
                </div>
            </section>

            <section class="card">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-server text-primary"></i>
                    <span>æœ€æ–°å¼€å¥–æ•°æ®</span>
                </h2>
                
                <div class="flex justify-between items-center mb-4">
                    <span class="font-semibold text-primary">è¿‘ 20 æœŸå¼€å¥–ç»“æœ</span>
                    <button id="refresh-data" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> åˆ·æ–°æ•°æ®
                    </button>
                </div>
                
                <div id="dataContainer">åŠ è½½ä¸­...</div>
                <div class="error-hint mt-3" id="apiErrorContainer" style="display:none"></div>
            </section>

            <section class="card">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-bar text-primary"></i>
                    <span>é¢„æµ‹æˆ˜ç»© & å‡†ç¡®ç‡</span>
                </h2>
                
                <div class="flex justify-between items-center mb-4">
                    <div class="text-lg font-bold text-primary">æœ€è¿‘10æœŸé¢„æµ‹è®°å½•</div>
                    <button id="refreshRecords" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> åˆ·æ–°æˆ˜ç»©
                    </button>
                </div>
                
                <div id="accuracyStats" class="result-grid mb-4">
                    <div class="result-item">
                        <div class="text-sm text-gray-600">æ€»é¢„æµ‹æ•°</div>
                        <div class="text-lg font-bold" id="totalPredictions">0</div>
                    </div>
                    <div class="result-item">
                        <div class="text-sm text-gray-600">æ­£ç¡®æ•°</div>
                        <div class="text-lg font-bold text-success" id="correctPredictions">0</div>
                    </div>
                    <div class="result-item">
                        <div class="text-sm text-gray-600">å‡†ç¡®ç‡</div>
                        <div class="text-lg font-bold text-primary" id="accuracyRate">0%</div>
                    </div>
                </div>
                
                <div id="recordsContainer" class="space-y-3">
                    <div class="text-center py-6 text-text-light">
                        æš‚æ— é¢„æµ‹è®°å½• (éœ€è¦åç«¯æœåŠ¡)
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOMå…ƒç´ å¼•ç”¨
            const $ = id => document.getElementById(id);
            // ç§»é™¤ç”¨æˆ·ç™»å½•/æ³¨å†Œ/ç®¡ç†åŠŸèƒ½
            let currentUser = { id: 1, username: 'Guest', role: 'guest' }; // æ¨¡æ‹Ÿä¸€ä¸ªè®¿å®¢ç”¨æˆ·
            let isLoggedIn = true; 

            // åˆå§‹åŒ–ï¼šç›´æ¥å¯åŠ¨ä¸»åº”ç”¨
            initPredictionSystem();
            loadPredictionRecords(); // å°è¯•åŠ è½½è®°å½•ï¼Œä½†ä¼šå¤±è´¥ï¼Œå› ä¸ºåç«¯æ–‡ä»¶ä¸å­˜åœ¨

            // é¢„æµ‹ç³»ç»Ÿæ ¸å¿ƒé€»è¾‘ï¼ˆä»åŸæ–‡ä»¶ä¿ç•™ï¼‰
            function initPredictionSystem() {
                // å½“å‰é€‰ä¸­çš„ç®—æ³•
                let currentAlgorithm = '3y';
                
                // 3Yå®šä¹‰
                const threeYDefinition = {
                    0: [0, 3, 6, 9, 12, 15, 18, 21, 24, 27],
                    1: [1, 4, 7, 10, 13, 16, 19, 22, 25],
                    2: [2, 5, 8, 11, 14, 17, 20, 23, 26]
                };

                // å¤§å°å•åŒå®šä¹‰
                const numberType = {
                    'å°å•': [1, 3, 5, 7, 9, 11, 13],
                    'å°åŒ': [0, 2, 4, 6, 8, 10, 12],
                    'å¤§å•': [15, 17, 19, 21, 23, 25, 27],
                    'å¤§åŒ': [14, 16, 18, 20, 22, 24, 26]
                };

                // è·å–æ•°å­—çš„3Yå±æ€§
                function getThreeY(num) {
                    for (let y in threeYDefinition) {
                        if (threeYDefinition[y].includes(num)) {
                            return parseInt(y);
                        }
                    }
                    return -1;
                }

                // è·å–æ•°å­—çš„å¤§å°å•åŒç±»å‹
                function getNumberType(num) {
                    for (let type in numberType) {
                        if (numberType[type].includes(num)) {
                            return type;
                        }
                    }
                    return 'æœªçŸ¥';
                }

                // æ€å·è§„åˆ™
                function getKillRule(type) {
                    const rules = {
                        'å¤§åŒ': 'å°å•',
                        'å°åŒ': 'å¤§å•',
                        'å¤§å•': 'å°åŒ',
                        'å°å•': 'å¤§åŒ'
                    };
                    return rules[type] || 'æ— ';
                }

                // åŸºäºç®—æ³•ç”Ÿæˆé¢„æµ‹ç»„åˆ
                function generatePredictionCombo(a, b, c, d) {
                    // è®¡ç®—å„ç±»å‹å¾—åˆ†
                    const scores = {
                        'å¤§åŒ': (d % 4 === 0 ? 2 : 0) + (a % 2 === 0 && b % 2 === 0 ? 1 : 0),
                        'å°åŒ': (d % 3 === 0 ? 2 : 0) + (a % 2 === 0 || b % 2 === 0 ? 1 : 0),
                        'å¤§å•': (d % 5 === 0 ? 2 : 0) + (c % 2 === 1 && b > 5 ? 1 : 0),
                        'å°å•': (d % 2 === 0 ? 2 : 0) + (a % 2 === 1 || c % 2 === 1 ? 1 : 0)
                    };

                    // æŒ‰å¾—åˆ†æ’åº
                    const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
                    
                    return {
                        primary: sorted[0][0],
                        secondary: sorted[1][0]
                    };
                }

                // 3Yç®—æ³•è®¡ç®—
                function calculate3YPrediction(latestData) {
                    if (latestData.length < 3) {
                        throw new Error('æ•°æ®ä¸è¶³3æœŸï¼Œæ— æ³•è®¡ç®—');
                    }

                    // å–æœ€æ–°ä¸‰æœŸæ•°æ®
                    const [third, second, first] = latestData.slice(0, 3);
                    
                    // è§£æå¼€å¥–å·ç 
                    const firstBalls = first.opencode.split(',').map(Number);
                    const secondBalls = second.opencode.split(',').map(Number);
                    const thirdBalls = third.opencode.split(',').map(Number);

                    // è®¡ç®—aå€¼
                    const a = (firstBalls[0] + secondBalls[1] + thirdBalls[2]) % 10;
                    
                    // è®¡ç®—bå€¼
                    const b = (firstBalls[2] + secondBalls[1] + thirdBalls[2]) % 10;
                    
                    // è®¡ç®—cå€¼
                    const c = (firstBalls[1] + secondBalls[1] + thirdBalls[1]) % 10;
                    
                    // è®¡ç®—då€¼
                    const d = a + b + c;
                    
                    // è·å–dçš„3Yå±æ€§
                    const dThreeY = getThreeY(d);
                    
                    if (dThreeY === -1) {
                        throw new Error('då€¼ä¸åœ¨æ•°æ®èŒƒå›´å†…');
                    }

                    // è®¡ç®—eå€¼
                    let e = 0;
                    
                    // æ‰¾åˆ°æœ€æ–°ä¸€æœŸä¸dåŒ3Yçš„æ•°æ®
                    const sameThreeYData = latestData.find(item => {
                        const sum = item.opencode.split(',').reduce((a, b) => parseInt(a) + parseInt(b), 0);
                        return getThreeY(sum) === dThreeY;
                    });

                    if (!sameThreeYData) {
                        // åœ¨æ— åç«¯æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸€ä¸ªç®€å•å›é€€é€»è¾‘
                        const fallbackPeriod = latestData[3];
                        const fallbackBalls = fallbackPeriod.opencode.split(',').map(Number);
                        const fallbackSum = fallbackBalls.reduce((a, b) => a + b, 0);

                        return {
                             success: false,
                             message: `æœªæ‰¾åˆ°ç›¸åŒ3Yæ•°æ®çš„æœŸæ•°ã€‚å’Œå€¼: ${latestSum}`
                        };
                    }

                    const sameBalls = sameThreeYData.opencode.split(',').map(Number);
                    
                    // æ ¹æ®dçš„3Yå±æ€§é€‰æ‹©çƒ
                    if (dThreeY === 1) {
                        e = d + sameBalls[0]; // åŠ ç¬¬ä¸€ä¸ªçƒ
                    } else if (dThreeY === 2) {
                        e = d + sameBalls[1]; // åŠ ç¬¬äºŒä¸ªçƒ
                    } else {
                        e = d + sameBalls[2]; // åŠ ç¬¬ä¸‰ä¸ªçƒ
                    }

                    // å¦‚æœeå¤§äº27ï¼Œæ˜¾ç¤ºæ— æ•°æ®
                    if (e > 27) {
                        return {
                            success: false,
                            message: 'æœ¬æœŸæ— æ•°æ®ï¼Œè¯·ç­‰å¾…ä¸‹ä¸€æœŸå¼€å¥–'
                        };
                    }

                    // è·å–æœ€æ–°ä¸€æœŸçš„å’Œå€¼
                    const latestSum = firstBalls.reduce((a, b) => a + b, 0);
                    const latestThreeY = getThreeY(latestSum);
                    const eThreeY = getThreeY(e);

                    // åˆ¤æ–­æ˜¯å¦åŒY
                    const isSameY = latestThreeY === eThreeY;

                    // ç”Ÿæˆé¢„æµ‹ç»„åˆ
                    const predictionCombo = generatePredictionCombo(a, b, c, d);
                    
                    let killType = '';
                    if (isSameY) {
                        // åŒYæƒ…å†µä¸‹æ€eæœ¬èº«
                        killType = getNumberType(e);
                    } else {
                        // ä¸åŒYæƒ…å†µä¸‹æ ¹æ®è§„åˆ™æ€å·
                        const eType = getNumberType(e);
                        killType = getKillRule(eType);
                    }

                    // ç¡®ä¿æ€å·ä¸ä¸ä¸»æ¨ç±»å‹å†²çª
                    if (killType === predictionCombo.primary) {
                        killType = getKillRule(predictionCombo.secondary);
                    }

                    return {
                        success: true,
                        data: {
                            a, b, c, d, e,
                            dThreeY: `3y${dThreeY}`,
                            eThreeY: `3y${eThreeY}`,
                            latestSum,
                            latestThreeY: `3y${latestThreeY}`,
                            isSameY,
                            killType,
                            predictionCombo,
                            calculation: {
                                firstPeriod: first.expect,
                                secondPeriod: second.expect,
                                thirdPeriod: third.expect,
                                sameThreeYPeriod: sameThreeYData.expect
                            }
                        }
                    };
                }

                // åŠ æ‹¿å¤§28ç®—æ³•è®¡ç®—
                function calculateCanada28Prediction(latestData) {
                    if (latestData.length < 3) {
                        throw new Error('æ•°æ®ä¸è¶³3æœŸï¼Œæ— æ³•è®¡ç®—');
                    }

                    // å–æœ€æ–°ä¸‰æœŸæ•°æ®
                    const [third, second, first] = latestData.slice(0, 3);
                    
                    // è§£æå¼€å¥–å·ç 
                    const firstBalls = first.opencode.split(',').map(Number);
                    const secondBalls = second.opencode.split(',').map(Number);
                    const thirdBalls = third.opencode.split(',').map(Number);

                    // æ‹¼æ¥æ•°å­—
                    const abc1 = parseInt(String(thirdBalls[0]) + String(secondBalls[0]) + String(firstBalls[0]));
                    const abc2 = parseInt(String(thirdBalls[1]) + String(secondBalls[1]) + String(firstBalls[1]));
                    const abc3 = parseInt(String(thirdBalls[2]) + String(secondBalls[2]) + String(firstBalls[2]));

                    // æ ¸å¿ƒè®¡ç®—
                    const dividend = abc1 + abc2 + abc3;
                    const divisor = firstBalls.reduce((a, b) => a + b, 0) + 
                                   secondBalls.reduce((a, b) => a + b, 0) + 
                                   thirdBalls.reduce((a, b) => a + b, 0);
                    
                    const divRes = dividend / (divisor || 1); // é¿å…é™¤é›¶
                    
                    // è·å–å½“å‰æ—¶é—´ä½œä¸ºæ—¶é—´ç³»æ•°
                    const now = new Date();
                    const h = now.getHours();
                    const m = now.getMinutes();
                    const coef = h + m / 100;
                    
                    const mulRes = Math.floor(divRes) * coef;
                    const finalNum = Math.floor(dividend - mulRes);

                    // å¤§å°å•åŒåˆ¤æ–­
                    const lastTwo = parseInt(String(finalNum).slice(-2));
                    const parity = lastTwo % 2 === 0 ? 'åŒ' : 'å•';
                    
                    const size = (() => {
                        if (lastTwo <= 13) return 'å°';
                        if (lastTwo <= 27) return 'å¤§';
                        if (lastTwo <= 49) return 'å°';
                        return 'å¤§';
                    })();
                    
                    // ç»„åˆé¢„æµ‹
                    const isBig = (() => {
                        if (lastTwo <= 13) return false;
                        if (lastTwo <= 27) return true;
                        if (lastTwo <= 49) return false;
                        return true;
                    })();
                    
                    const isOdd = lastTwo % 2 === 1;
                    let combo = '';
                    if (isBig && isOdd) combo = 'å¤§å•';
                    else if (isBig && !isOdd) combo = 'å¤§åŒ';
                    else if (!isBig && isOdd) combo = 'å°å•';
                    else combo = 'å°åŒ';
                    
                    // åŒç»„é¢„æµ‹
                    const comboSecondary = {
                        'å¤§å•': 'å°å•å¤§åŒ',
                        'å°å•': 'å°åŒå¤§å•',
                        'å°åŒ': 'å°å•å¤§åŒ',
                        'å¤§åŒ': 'å°åŒå¤§å•'
                    }[combo] || '';

                    return {
                        success: true,
                        data: {
                            finalNum,
                            lastTwo,
                            size,
                            parity,
                            combo,
                            comboSecondary,
                            calculation: {
                                abc1, abc2, abc3,
                                dividend, divisor,
                                divRes: divRes.toFixed(2),
                                coef: coef.toFixed(2),
                                mulRes: mulRes.toFixed(2),
                                firstPeriod: first.expect,
                                secondPeriod: second.expect,
                                thirdPeriod: third.expect
                            }
                        }
                    };
                }

                // è·å–å¼€å¥–æ•°æ®
                async function fetchData() {
                    const box = $('dataContainer');
                    const err = $('apiErrorContainer');
                    
                    box.innerHTML = '<div class="text-center"><span class="loading"></span> åŠ è½½ä¸­...</div>';
                    err.style.display = 'none';
                    
                    try {
                        const res = await fetch('https://super.pc28998.com/history/JND28?limit=20&t=' + Date.now());
                        if (!res.ok) throw new Error(`HTTP ${res.status}`);
                        
                        const data = await res.json();
                        
                        if (!data.data || !Array.isArray(data.data) || data.data.length === 0) {
                            throw new Error('APIè¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®æˆ–ä¸ºç©º');
                        }
                        
                        box.innerHTML = `
                            <div class="lottery-grid">
                                ${data.data.slice(0, 20).map(item => {
                                    const numbers = item.opencode || '0,0,0';
                                    const sum = numbers.split(',').reduce((a, b) => parseInt(a) + parseInt(b), 0);
                                    const threeY = getThreeY(sum);
                                    const period = item.expect || 'æœªçŸ¥æœŸå·';
                                    const time = item.opentime || item.time || 'æœªçŸ¥æ—¶é—´';
                                    
                                    return `
                                        <div class="lottery-item">
                                            <div class="font-bold text-primary">${period}</div>
                                            <div class="text-lg font-bold my-2">${numbers}</div>
                                            <div class="text-sm">æ€»å’Œ: <span class="${sum > 13 ? 'text-danger' : 'text-primary'} font-bold">${sum}</span></div>
                                            <div class="text-xs text-gray-600">3y${threeY}</div>
                                            <div class="text-xs text-gray-500 mt-1">${time}</div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `;
                        
                    } catch(e) {
                        console.error('è·å–å¼€å¥–æ•°æ®å¤±è´¥:', e);
                        err.style.display = 'block';
                        err.textContent = `è·å–å¤±è´¥: ${e.message}`;
                        box.innerHTML = '<div class="text-center py-6 text-danger">åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•</div>';
                    }
                }

                // é¢„æµ‹æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                $('predict-btn').onclick = async function() {
                    const btn = $('predict-btn');
                    const resultContent = $('result-content');
                    
                    btn.innerHTML = '<span class="loading"></span> è®¡ç®—ä¸­...';
                    btn.disabled = true;
                    
                    try {
                        const res = await fetch('https://super.pc28998.com/history/JND28?limit=20&t=' + Date.now());
                        if (!res.ok) throw new Error(`HTTP ${res.status}`);
                        
                        const data = await res.json();
                        
                        if (!data.data || data.data.length < 3) {
                            throw new Error('æ•°æ®ä¸è¶³ï¼Œæ— æ³•è®¡ç®—');
                        }
                        
                        let prediction;
                        if (currentAlgorithm === '3y') {
                            prediction = calculate3YPrediction(data.data);
                        } else {
                            prediction = calculateCanada28Prediction(data.data);
                        }
                        
                        if (!prediction.success) {
                            resultContent.innerHTML = `
                                <div class="text-center text-danger py-6">
                                    <i class="fas fa-exclamation-triangle"></i><br>
                                    ${prediction.message}
                                </div>
                            `;
                            return;
                        }
                        
                        const p = prediction.data;
                        
                        // ç§»é™¤ä¿å­˜é¢„æµ‹è®°å½•å’Œæ›´æ–°ç»“æœçš„ä»£ç  (å› ä¸ºå®ƒä¾èµ–äºåç«¯æ–‡ä»¶)
                        // await savePrediction(...)
                        // await updateActualResult(...)
                        // await loadPredictionRecords();
                        
                        if (currentAlgorithm === '3y') {
                            resultContent.innerHTML = `
                                <div class="result-grid">
                                    <div class="result-item">
                                        <div class="text-sm text-gray-600">aå€¼</div>
                                        <div class="text-lg font-bold">${p.a}</div>
                                    </div>
                                    <div class="result-item">
                                        <div class="text-sm text-gray-600">bå€¼</div>
                                        <div class="text-lg font-bold">${p.b}</div>
                                    </div>
                                    <div class="result-item">
                                        <div class="text-sm text-gray-600">cå€¼</div>
                                        <div class="text-lg font-bold">${p.c}</div>
                                    </div>
                                    <div class="result-item">
                                        <div class="text-sm text-gray-600">då€¼</div>
                                        <div class="text-lg font-bold">${p.d} (${p.dThreeY})</div>
                                    </div>
                                    <div class="result-item">
                                        <div class="text-sm text-gray-600">eå€¼</div>
                                        <div class="text-lg font-bold">${p.e} (${p.eThreeY})</div>
                                    </div>
                                    <div class="result-item">
                                        <div class="text-sm text-gray-600">æœ€æ–°å’Œå€¼</div>
                                        <div class="text-lg font-bold">${p.latestSum} (${p.latestThreeY})</div>
                                    </div>
                                </div>
                                
                                <div class="kill-item mt-4">
                                    ${p.isSameY ? 
                                        `æ•°æ®å½¢æ€çŸ›ç›¾æƒ…å†µï¼Œæ€æ•°å­—: <span class="text-danger">${p.killType}</span>` :
                                        `æ€ç±»å‹: <span class="text-danger">${p.killType}</span>`
                                    }
                                </div>
                                
                                <div class="prediction-combo mt-4">
                                    <div class="font-bold text-primary mb-2">é¢„æµ‹ç»„åˆ</div>
                                    <div class="flex justify-between py-2 border-b border-gray-200">
                                        <span>ä¸»æ¨:</span>
                                        <span class="font-bold text-secondary">${p.predictionCombo.primary}</span>
                                    </div>
                                    <div class="flex justify-between py-2">
                                        <span>æ¬¡æ¨:</span>
                                        <span class="font-bold text-secondary">${p.predictionCombo.secondary}</span>
                                    </div>
                                </div>
                                
                                <div class="mt-3 text-xs text-gray-600">
                                    <div>è®¡ç®—ä½¿ç”¨æœŸæ•°: ${p.calculation.firstPeriod}, ${p.calculation.secondPeriod}, ${p.calculation.thirdPeriod}</div>
                                    <div>å‚è€ƒæœŸæ•°: ${p.calculation.sameThreeYPeriod}</div>
                                </div>
                            `;
                        } else {
                            resultContent.innerHTML = `
                                <div class="result-grid">
                                    <div class="result-item">
                                        <div class="text-sm text-gray-600">æœ€ç»ˆé¢„æµ‹æ•°å­—</div>
                                        <div class="text-lg font-bold">${p.finalNum}</div>
                                    </div>
                                    <div class="result-item">
                                        <div class="text-sm text-gray-600">æœ«ä¸¤ä½æ•°å­—</div>
                                        <div class="text-lg font-bold">${p.lastTwo}</div>
                                    </div>
                                    <div class="result-item">
                                        <div class="text-sm text-gray-600">å¤§å°</div>
                                        <div class="text-lg font-bold">${p.size}</div>
                                    </div>
                                    <div class="result-item">
                                        <div class="text-sm text-gray-600">å•åŒ</div>
                                        <div class="text-lg font-bold">${p.parity}</div>
                                    </div>
                                </div>
                                
                                <div class="prediction-combo mt-4">
                                    <div class="font-bold text-primary mb-2">é¢„æµ‹ç»„åˆ</div>
                                    <div class="flex justify-between py-2 border-b border-gray-200">
                                        <span>ä¸»æ¨:</span>
                                        <span class="font-bold text-secondary">${p.combo}</span>
                                    </div>
                                    <div class="flex justify-between py-2">
                                        <span>åŒç»„é¢„æµ‹:</span>
                                        <span class="font-bold text-secondary">${p.comboSecondary}</span>
                                    </div>
                                </div>
                                
                                <div class="mt-3 text-xs text-gray-600">
                                    <div>è®¡ç®—ä½¿ç”¨æœŸæ•°: ${p.calculation.firstPeriod}, ${p.calculation.secondPeriod}, ${p.calculation.thirdPeriod}</div>
                                    <div>æ‹¼æ¥æ•°å­—: abc1=${p.calculation.abc1}, abc2=${p.calculation.abc2}, abc3=${p.calculation.abc3}</div>
                                    <div>è¢«é™¤æ•°: ${p.calculation.dividend}, é™¤æ•°: ${p.calculation.divisor}</div>
                                    <div>é™¤æ³•ç»“æœ: ${p.calculation.divRes}, æ—¶é—´ç³»æ•°: ${p.calculation.coef}</div>
                                    <div>ä¹˜æ³•ç»“æœ: ${p.calculation.mulRes}</div>
                                </div>
                            `;
                        }
                        
                    } catch(e) {
                        console.error('é¢„æµ‹è®¡ç®—å¤±è´¥:', e);
                        resultContent.innerHTML = `
                            <div class="text-center text-danger py-6">
                                <i class="fas fa-exclamation-triangle"></i><br>
                                è®¡ç®—å¤±è´¥: ${e.message}
                            </div>
                        `;
                    } finally {
                        btn.innerHTML = '<i class="fas fa-bolt"></i> å¼€å§‹é¢„æµ‹';
                        btn.disabled = false;
                    }
                };

                // ç®—æ³•åˆ‡æ¢
                document.querySelectorAll('.algorithm-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        document.querySelectorAll('.algorithm-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        currentAlgorithm = this.dataset.algorithm;
                        
                        const description = $('algorithm-description');
                        if (currentAlgorithm === '3y') {
                            description.innerHTML = '<strong>å½¢æ€æ•°æ®åˆ†æç®—æ³•</strong>ï¼šåŸºäºä¸‰æœŸå†å²æ•°æ®ï¼Œé€šè¿‡å½¢æ€å±æ€§å’Œæ•°æ®åˆ†æã€å¤§å°å•åŒç±»å‹è¿›è¡Œé¢„æµ‹ï¼Œç»“åˆæ€å·è§„åˆ™æé«˜å‡†ç¡®æ€§ã€‚';
                        } else {
                            description.innerHTML = '<strong>åŠ æ‹¿å¤§28ç®—æ³•</strong>ï¼šåŸºäºä¸‰æœŸå†å²æ•°æ®å’Œæ—¶é—´ç³»æ•°ï¼Œé€šè¿‡æ•°å­—æ‹¼æ¥å’Œæ•°å­¦è¿ç®—è¿›è¡Œé¢„æµ‹ï¼Œç»“åˆå¤§å°å•åŒåˆ¤æ–­ã€‚';
                        }
                    });
                });

                // åˆ·æ–°æ•°æ®æŒ‰é’®
                $('refresh-data').onclick = fetchData;

                // åˆå§‹åŒ–åŠ è½½æ•°æ®
                fetchData();
            }

            // å­˜æ ¹å‡½æ•° (å› ä¸ºåç«¯æ–‡ä»¶å·²è¢«ç§»é™¤)
            async function loadPredictionRecords() {
                $('recordsContainer').innerHTML = '<div class="text-center py-6 text-text-light">é¢„æµ‹æˆ˜ç»©åŠŸèƒ½å·²è¢«ç¦ç”¨ï¼ˆåŸéœ€åç«¯æœåŠ¡æ”¯æŒï¼‰</div>';
            }
            
            document.getElementById('refreshRecords').onclick = loadPredictionRecords; // ç»‘å®šåˆ·æ–°æŒ‰é’®åˆ°å­˜æ ¹å‡½æ•°
        });
    </script>
</body>
</html>